<?php
 abstract class __events extends baseModuleAdmin {public function last() {$this->setDataType("settings");$this->setActionType("view");$vf9a0f0fbe51f3ec810ee16d6774e434e = array();$v8d777f385d3dfec8815d20f7496026dc = $this->prepareData($vf9a0f0fbe51f3ec810ee16d6774e434e, 'settings');$vb10a8c0bede9eb4ea771b04db3149f28 = ConnectionPool::getInstance();$v4717d53ebfdfea8477f780ec66151dcb = $vb10a8c0bede9eb4ea771b04db3149f28->getConnection();umiEventFeed::setConnection($v4717d53ebfdfea8477f780ec66151dcb);umiEventFeedType::setConnection($v4717d53ebfdfea8477f780ec66151dcb);$vee11cbb19052e40b07aac0ca060c23ee = $this->getUser();$v2e5d8aa3dfa8ef34ca5131d20f9dad51 = umiEventFeedType::getAllowedList($vee11cbb19052e40b07aac0ca060c23ee->getSettings());$vfc7f6423b4974f8363e6cd8f3e9a6c78 = array('nodes:new-event' => array());foreach ($v2e5d8aa3dfa8ef34ca5131d20f9dad51 as $v5f694956811487225d15e973ca38fbab) {$ve2942a04780e223b215eb8b663cf5353 = umiEventFeed::getListCount(array($v5f694956811487225d15e973ca38fbab), $vee11cbb19052e40b07aac0ca060c23ee->getId());if (!$ve2942a04780e223b215eb8b663cf5353) continue;$vfc7f6423b4974f8363e6cd8f3e9a6c78['nodes:new-event'][$v5f694956811487225d15e973ca38fbab]['attribute:type-id'] = $v5f694956811487225d15e973ca38fbab;$vfc7f6423b4974f8363e6cd8f3e9a6c78['nodes:new-event'][$v5f694956811487225d15e973ca38fbab]['attribute:count'] = $ve2942a04780e223b215eb8b663cf5353;$vfc7f6423b4974f8363e6cd8f3e9a6c78['nodes:new-event'][$v5f694956811487225d15e973ca38fbab]['attribute:name'] = getLabel($v5f694956811487225d15e973ca38fbab . '_new');$vfc7f6423b4974f8363e6cd8f3e9a6c78['nodes:new-event'][$v5f694956811487225d15e973ca38fbab]['attribute:img'] = getLabel($v5f694956811487225d15e973ca38fbab . '_img');$vfc7f6423b4974f8363e6cd8f3e9a6c78['nodes:new-event'][$v5f694956811487225d15e973ca38fbab]['events'] = array('nodes:events' => array());$vdeb9fb6f3a9c98f75f1ee3cdd8ffa40e = umiEventFeed::getUnreadList($v5f694956811487225d15e973ca38fbab, $vee11cbb19052e40b07aac0ca060c23ee->getId(), 3);foreach ($vdeb9fb6f3a9c98f75f1ee3cdd8ffa40e as $v53cc4db543d7a569e51c1d76ac6f278e => $v4119639092e62c55ea8be348e4d9260d) {$vfc7f6423b4974f8363e6cd8f3e9a6c78['nodes:new-event'][$v5f694956811487225d15e973ca38fbab]['events']['nodes:event'][$v53cc4db543d7a569e51c1d76ac6f278e] = self::renderEvent($v4119639092e62c55ea8be348e4d9260d);}}$v8d777f385d3dfec8815d20f7496026dc['new-events'] = $vfc7f6423b4974f8363e6cd8f3e9a6c78;$this->setData($v8d777f385d3dfec8815d20f7496026dc);return $this->doData();}public function feed() {$this->setDataType("settings");$this->setActionType("view");$vf9a0f0fbe51f3ec810ee16d6774e434e = array();$v8d777f385d3dfec8815d20f7496026dc = $this->prepareData($vf9a0f0fbe51f3ec810ee16d6774e434e, 'settings');$vaa9f73eea60a006820d0f8768bc8a3fc = 19;$v83878c91171338902e0fe0fb97a8c47a = (int) getRequest('p');$v7a86c157ee9713c34fbd7a1ee40f0c5a = $vaa9f73eea60a006820d0f8768bc8a3fc * $v83878c91171338902e0fe0fb97a8c47a;$v5a0eeddea3917f781ddb458441cc2a3e = (int) regedit::getInstance()->getVal("//modules/banners/max-days-storing-events");$v9f7391efa205f31447021c4683e92bec = $v5a0eeddea3917f781ddb458441cc2a3e > 0 ? time() - ($v5a0eeddea3917f781ddb458441cc2a3e * 24 * 60 * 60) : '';$ve4dfb3f5dd911dc868eb4f2c2a836d64 = getRequest('start_date') ? strtotime(getRequest('start_date')) : $v9f7391efa205f31447021c4683e92bec;$v813e94378d42501d835b2ed6253dc463 = getRequest('end_date') ? strtotime(getRequest('end_date')) : '';$vb2c97ae425dd751b0e48a3acae79cf4a = getRequest('filter');$v9883b07b3922c5e72c035bee84cf4f1b = (bool) getRequest('onlyUnread');$vb10a8c0bede9eb4ea771b04db3149f28 = ConnectionPool::getInstance();$v4717d53ebfdfea8477f780ec66151dcb = $vb10a8c0bede9eb4ea771b04db3149f28->getConnection();umiEventFeed::setConnection($v4717d53ebfdfea8477f780ec66151dcb);umiEventFeedType::setConnection($v4717d53ebfdfea8477f780ec66151dcb);$vee11cbb19052e40b07aac0ca060c23ee = $this->getUser();$v2e5d8aa3dfa8ef34ca5131d20f9dad51 = $vb2c97ae425dd751b0e48a3acae79cf4a ? array($vb2c97ae425dd751b0e48a3acae79cf4a) : umiEventFeedType::getAllowedList($vee11cbb19052e40b07aac0ca060c23ee->getSettings());$v09353387931db36c8af0e1b3658ddffe = array('nodes:event' => array());if ($vb2c97ae425dd751b0e48a3acae79cf4a && $v9883b07b3922c5e72c035bee84cf4f1b) {$vdeb9fb6f3a9c98f75f1ee3cdd8ffa40e = umiEventFeed::getUnreadList($vb2c97ae425dd751b0e48a3acae79cf4a, $vee11cbb19052e40b07aac0ca060c23ee->getId(), $vaa9f73eea60a006820d0f8768bc8a3fc, $v7a86c157ee9713c34fbd7a1ee40f0c5a, $ve4dfb3f5dd911dc868eb4f2c2a836d64, $v813e94378d42501d835b2ed6253dc463);foreach ($vdeb9fb6f3a9c98f75f1ee3cdd8ffa40e as $v53cc4db543d7a569e51c1d76ac6f278e => $v4119639092e62c55ea8be348e4d9260d) {$v09353387931db36c8af0e1b3658ddffe['nodes:event'][$v53cc4db543d7a569e51c1d76ac6f278e] = self::renderEvent($v4119639092e62c55ea8be348e4d9260d);}$v8d777f385d3dfec8815d20f7496026dc['attribute:total'] = umiEventFeed::getListCount($v2e5d8aa3dfa8ef34ca5131d20f9dad51, $vee11cbb19052e40b07aac0ca060c23ee->getId(), $ve4dfb3f5dd911dc868eb4f2c2a836d64, $v813e94378d42501d835b2ed6253dc463);}else {$v16908b0605f2645dfcb4c3a8d248cef3 = umiEventFeed::getList($v2e5d8aa3dfa8ef34ca5131d20f9dad51, $vee11cbb19052e40b07aac0ca060c23ee->getId(), $vaa9f73eea60a006820d0f8768bc8a3fc, $v7a86c157ee9713c34fbd7a1ee40f0c5a, $ve4dfb3f5dd911dc868eb4f2c2a836d64, $v813e94378d42501d835b2ed6253dc463);foreach($v16908b0605f2645dfcb4c3a8d248cef3 as $v53cc4db543d7a569e51c1d76ac6f278e => $vce3280d763b11208823de6adaa1d80dd) {$v09353387931db36c8af0e1b3658ddffe['nodes:event'][$v53cc4db543d7a569e51c1d76ac6f278e] = self::renderEvent($vce3280d763b11208823de6adaa1d80dd['event'], $vce3280d763b11208823de6adaa1d80dd['read']);}$v8d777f385d3dfec8815d20f7496026dc['attribute:total'] = umiEventFeed::getListCount($v2e5d8aa3dfa8ef34ca5131d20f9dad51, false, $ve4dfb3f5dd911dc868eb4f2c2a836d64, $v813e94378d42501d835b2ed6253dc463);}$v8d777f385d3dfec8815d20f7496026dc['attribute:offset'] = $v7a86c157ee9713c34fbd7a1ee40f0c5a;$v8d777f385d3dfec8815d20f7496026dc['attribute:limit'] = $vaa9f73eea60a006820d0f8768bc8a3fc;$v8d777f385d3dfec8815d20f7496026dc['events'] = $v09353387931db36c8af0e1b3658ddffe;$this->setData($v8d777f385d3dfec8815d20f7496026dc);return $this->doData();}private static function renderEvent($v4119639092e62c55ea8be348e4d9260d, $vecae13117d6f0584c25a9da6c8f8415e = 0) {$vce3280d763b11208823de6adaa1d80dd = array();$vce3280d763b11208823de6adaa1d80dd['attribute:id'] = $v4119639092e62c55ea8be348e4d9260d->getId();$vce3280d763b11208823de6adaa1d80dd['attribute:type-id'] = $v4119639092e62c55ea8be348e4d9260d->getTypeId();$vce3280d763b11208823de6adaa1d80dd['attribute:read'] = (int) $vecae13117d6f0584c25a9da6c8f8415e;$v8314f7e7b648c91b83817a870b5857a3 = new umiDate($v4119639092e62c55ea8be348e4d9260d->getDate());$vce3280d763b11208823de6adaa1d80dd['attribute:timestamp'] = $v8314f7e7b648c91b83817a870b5857a3->getDateTimeStamp();$vce3280d763b11208823de6adaa1d80dd['attribute:date'] = $v8314f7e7b648c91b83817a870b5857a3->getFormattedDate('d.m.Y H:i');$v21ffce5b8a6cc8cc6a41448dd69623c9 = $v4119639092e62c55ea8be348e4d9260d->getParams();$vce3280d763b11208823de6adaa1d80dd['node:value'] = ulangStream::getLabelSimple($v4119639092e62c55ea8be348e4d9260d->getTypeId() . "_msg", $v21ffce5b8a6cc8cc6a41448dd69623c9);return $vce3280d763b11208823de6adaa1d80dd;}public function saveSettings($v7d1b98ec98cdcfba1cb39cb36a9f9ec0 = null) {$vb10a8c0bede9eb4ea771b04db3149f28 = ConnectionPool::getInstance();$v4717d53ebfdfea8477f780ec66151dcb = $vb10a8c0bede9eb4ea771b04db3149f28->getConnection();umiEventFeedType::setConnection($v4717d53ebfdfea8477f780ec66151dcb);if (!is_array($v7d1b98ec98cdcfba1cb39cb36a9f9ec0)) $v7d1b98ec98cdcfba1cb39cb36a9f9ec0 = getRequest('settings');$v2e5d8aa3dfa8ef34ca5131d20f9dad51 = array();if (is_array($v7d1b98ec98cdcfba1cb39cb36a9f9ec0) && count($v7d1b98ec98cdcfba1cb39cb36a9f9ec0)) {$v2e5d8aa3dfa8ef34ca5131d20f9dad51 = umiEventFeedType::getAllowedList($v7d1b98ec98cdcfba1cb39cb36a9f9ec0);}$vee11cbb19052e40b07aac0ca060c23ee = $this->getUser();$vee11cbb19052e40b07aac0ca060c23ee->setSettings($v2e5d8aa3dfa8ef34ca5131d20f9dad51);$vee11cbb19052e40b07aac0ca060c23ee->save();}public function markReadEvents($v16908b0605f2645dfcb4c3a8d248cef3 = null) {if (!is_array($v16908b0605f2645dfcb4c3a8d248cef3)) $v16908b0605f2645dfcb4c3a8d248cef3 = getRequest('events');if (is_array($v16908b0605f2645dfcb4c3a8d248cef3)) {$vee11cbb19052e40b07aac0ca060c23ee = $this->getUser();$vb10a8c0bede9eb4ea771b04db3149f28 = ConnectionPool::getInstance();$v4717d53ebfdfea8477f780ec66151dcb = $vb10a8c0bede9eb4ea771b04db3149f28->getConnection();umiEventFeed::setConnection($v4717d53ebfdfea8477f780ec66151dcb);foreach ($v16908b0605f2645dfcb4c3a8d248cef3 as $v53cc4db543d7a569e51c1d76ac6f278e) {umiEventFeed::markReadEvent($v53cc4db543d7a569e51c1d76ac6f278e, $vee11cbb19052e40b07aac0ca060c23ee->getId());}}}public function markUnreadEvents($v16908b0605f2645dfcb4c3a8d248cef3 = null) {if (!is_array($v16908b0605f2645dfcb4c3a8d248cef3)) $v16908b0605f2645dfcb4c3a8d248cef3 = getRequest('events');if (is_array($v16908b0605f2645dfcb4c3a8d248cef3)) {$vee11cbb19052e40b07aac0ca060c23ee = $this->getUser();$vb10a8c0bede9eb4ea771b04db3149f28 = ConnectionPool::getInstance();$v4717d53ebfdfea8477f780ec66151dcb = $vb10a8c0bede9eb4ea771b04db3149f28->getConnection();umiEventFeed::setConnection($v4717d53ebfdfea8477f780ec66151dcb);foreach ($v16908b0605f2645dfcb4c3a8d248cef3 as $v53cc4db543d7a569e51c1d76ac6f278e) {umiEventFeed::markUnreadEvent($v53cc4db543d7a569e51c1d76ac6f278e, $vee11cbb19052e40b07aac0ca060c23ee->getId());}}}public function addEventType() {$v2f264034c73acbd6baae70dd7edb3d3f = getRequest('event-type');$vb10a8c0bede9eb4ea771b04db3149f28 = ConnectionPool::getInstance();$v4717d53ebfdfea8477f780ec66151dcb = $vb10a8c0bede9eb4ea771b04db3149f28->getConnection();umiEventFeedType::setConnection($v4717d53ebfdfea8477f780ec66151dcb);umiEventFeedType::create($v2f264034c73acbd6baae70dd7edb3d3f);$this->redirect(getServer("HTTP_REFERER"));}public function config() {$vb1444fb0c07653567ad325aa25d4e37a = regedit::getInstance();$v21ffce5b8a6cc8cc6a41448dd69623c9 = Array (    "config" => Array (     "int:max-days-storing-events" => null,     "boolean:collect-events" => null    )   );$v15d61712450a686a7f365adf4fef581f = getRequest("param0");if ($v15d61712450a686a7f365adf4fef581f == "do"){if (!is_demo()) {$v21ffce5b8a6cc8cc6a41448dd69623c9 = $this->expectParams($v21ffce5b8a6cc8cc6a41448dd69623c9);$vb1444fb0c07653567ad325aa25d4e37a->setVar("//modules/events/max-days-storing-events", (int) $v21ffce5b8a6cc8cc6a41448dd69623c9["config"]["int:max-days-storing-events"]);$vb1444fb0c07653567ad325aa25d4e37a->setVar("//modules/events/collect-events", (int) $v21ffce5b8a6cc8cc6a41448dd69623c9["config"]["boolean:collect-events"]);$this->chooseRedirect();}}$v21ffce5b8a6cc8cc6a41448dd69623c9["config"]["int:max-days-storing-events"] = (int) $vb1444fb0c07653567ad325aa25d4e37a->getVal("//modules/events/max-days-storing-events");$v21ffce5b8a6cc8cc6a41448dd69623c9["config"]["boolean:collect-events"] = (bool) $vb1444fb0c07653567ad325aa25d4e37a->getVal("//modules/events/collect-events");$this->setDataType("settings");$this->setActionType("modify");$v8d777f385d3dfec8815d20f7496026dc = $this->prepareData($v21ffce5b8a6cc8cc6a41448dd69623c9, "settings");$this->setData($v8d777f385d3dfec8815d20f7496026dc);return $this->doData();}};?>
